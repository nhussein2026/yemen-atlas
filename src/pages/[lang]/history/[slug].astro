---
import { getCollection } from "astro:content";
import { assertLang } from "../../../lib/lang";
import BaseLayout from "../../../layouts/BaseLayout.astro";

export async function getStaticPaths() {
  const history_posts = await getCollection("history");

  return history_posts.flatMap((post) => [
    { params: { lang: "en", slug: post.slug } },
    { params: { lang: "ar", slug: post.slug } },
  ]);
}

const { lang, slug } = Astro.params;
assertLang(lang);

// Find the city by slug
const history = await getCollection("history");
const history_post = history.find((c) => c.slug === slug);

if (!history_post) {
  throw new Error(`history_post not found: ${slug}`);
}

const isArabic = lang === "ar";
const { Content } = await history_post.render();
---

<BaseLayout
  lang={lang}
  title={history_post.data.name[lang]}
  description={history_post.data.description[lang]}
>
  <div class={`${isArabic ? "rtl" : "ltr"}`} dir={isArabic ? "rtl" : "ltr"}>
    <div class="content-wrapper">
      <article class="content-container">
        <!-- Article Header -->
        <header class="article-header">
          <h1 class="article-title">
            {history_post.data.name[lang]}
          </h1>
          <p class="article-description">
            {history_post.data.description[lang]}
          </p>

          {
            history_post.data.summary && (
              <p class="article-summary">{history_post.data.summary[lang]}</p>
            )
          }
        </header>

        <!-- Article Content -->
        <div class="article-content">
          <Content />
        </div>
      </article>
    </div>
  </div>
</BaseLayout>

<style>
  /* Content Wrapper - Centers content */
  .content-wrapper {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0 1rem;
  }

  .content-container {
    width: 100%;
    max-width: 48rem; /* 768px */
    padding: 0;
  }

  @media (min-width: 768px) {
    .content-wrapper {
      padding: 0 1.5rem;
    }
  }

  @media (min-width: 1024px) {
    .content-wrapper {
      padding: 0 2rem;
    }
  }

  /* Article Header */
  .article-header {
    margin-bottom: 2.5rem;
    padding-bottom: 2.5rem;
    border-bottom: 1px solid var(--atlas-border);
  }

  @media (min-width: 768px) {
    .article-header {
      margin-bottom: 3rem;
      padding-bottom: 3rem;
    }
  }

  .article-title {
    font-size: clamp(2rem, 6vw, 3rem);
    font-weight: 700;
    margin: 0 0 1.25rem 0;
    color: var(--atlas-archive);
    line-height: 1.2;
    letter-spacing: -0.5px;
  }

  @media (min-width: 768px) {
    .article-title {
      margin-bottom: 1.5rem;
    }
  }

  .article-description {
    font-size: clamp(0.9375rem, 2vw, 1rem);
    line-height: 1.75;
    color: var(--atlas-archive);
    margin: 0 0 1.5rem 0;
    text-align: justify;
    word-spacing: 0.1em;
    letter-spacing: 0.3px;
  }

  @media (min-width: 768px) {
    .article-description {
      margin-bottom: 2rem;
    }
  }

  .article-summary {
    font-size: clamp(0.875rem, 1.5vw, 0.95rem);
    line-height: 1.75;
    color: var(--atlas-stone);
    margin: 0;
    font-style: italic;
    padding: 1.25rem;
    background-color: var(--atlas-paper);
    border-left: 4px solid var(--atlas-terracotta);
    border-radius: 0.375rem;
  }

  [dir="rtl"] .article-summary {
    border-left: none;
    border-right: 4px solid var(--atlas-terracotta);
  }

  /* Article Content */
  .article-content {
    margin-bottom: 1rem;
  }

  .article-content :global(p) {
    margin: 1.75rem 0;
    line-height: 1.8;
    color: var(--atlas-archive);
    text-align: justify;
    word-spacing: 0.1em;
    letter-spacing: 0.3px;
  }

  .article-content :global(p:first-child) {
    margin-top: 0;
  }

  .article-content :global(h2) {
    margin-top: 2.5rem;
    margin-bottom: 1.25rem;
    font-size: clamp(1.375rem, 3.5vw, 1.875rem);
    font-weight: 600;
    color: var(--atlas-terracotta);
    border-bottom: 2px solid var(--atlas-border);
    padding-bottom: 0.75rem;
    line-height: 1.3;
  }

  .article-content :global(h2:first-child) {
    margin-top: 0;
  }

  .article-content :global(h3) {
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-size: clamp(1.125rem, 2.5vw, 1.375rem);
    font-weight: 600;
    color: var(--atlas-archive);
    line-height: 1.3;
  }

  .article-content :global(strong) {
    font-weight: 600;
    color: var(--atlas-terracotta);
  }

  .article-content :global(ul),
  .article-content :global(ol) {
    margin: 1.75rem 0;
    padding-left: 2rem;
  }

  [dir="rtl"] .article-content :global(ul),
  [dir="rtl"] .article-content :global(ol) {
    padding-left: 0;
    padding-right: 2rem;
  }

  .article-content :global(li) {
    margin: 0.625rem 0;
    line-height: 1.7;
    color: var(--atlas-archive);
  }

  .article-content :global(li) :global(p) {
    margin: 0.5rem 0;
  }

  .article-content :global(a) {
    color: var(--atlas-sand);
    text-decoration: underline;
    transition: opacity 300ms ease;
  }

  .article-content :global(a:hover) {
    opacity: 0.8;
  }

  .article-content :global(blockquote) {
    margin: 1.75rem 0;
    padding-left: 1.25rem;
    border-left: 4px solid var(--atlas-terracotta);
    color: var(--atlas-stone);
    font-style: italic;
    line-height: 1.7;
  }

  [dir="rtl"] .article-content :global(blockquote) {
    padding-left: 0;
    padding-right: 1.25rem;
    border-left: none;
    border-right: 4px solid var(--atlas-terracotta);
  }

  .article-content :global(code) {
    background-color: var(--atlas-paper);
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-family: monospace;
    color: var(--atlas-archive);
    font-size: 0.9em;
  }

  .article-content :global(pre) {
    background-color: var(--atlas-paper);
    padding: 1.5rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 1.75rem 0;
    border: 1px solid var(--atlas-border);
  }

  .article-content :global(pre code) {
    background-color: transparent;
    padding: 0;
    color: var(--atlas-archive);
  }

  .article-content :global(img) {
    max-width: 100%;
    height: auto;
    margin: 2rem 0;
    border-radius: 0.5rem;
  }

  .article-content :global(table) {
    width: 100%;
    border-collapse: collapse;
    margin: 1.75rem 0;
  }

  .article-content :global(th),
  .article-content :global(td) {
    padding: 0.875rem;
    border: 1px solid var(--atlas-border);
    text-align: left;
  }

  .article-content :global(th) {
    background-color: var(--atlas-paper);
    font-weight: 600;
    color: var(--atlas-archive);
  }

  .article-content :global(td) {
    color: var(--atlas-archive);
  }

  /* Responsive adjustments for small screens */
  @media (max-width: 640px) {
    .article-header {
      margin-bottom: 2rem;
      padding-bottom: 2rem;
    }

    .article-title {
      font-size: 1.875rem;
      margin-bottom: 1rem;
    }

    .article-description {
      font-size: 0.9375rem;
      margin-bottom: 1.25rem;
    }

    .article-summary {
      padding: 1rem;
      font-size: 0.875rem;
    }

    .article-content :global(h2) {
      margin-top: 2rem;
      margin-bottom: 1rem;
      font-size: 1.375rem;
    }

    .article-content :global(h3) {
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
      font-size: 1.125rem;
    }

    .article-content :global(p) {
      margin: 1.5rem 0;
      font-size: 0.9375rem;
    }
  }
</style>
